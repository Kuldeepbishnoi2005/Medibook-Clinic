<%- include('partials/header', { activePage: 'doctor-appointments' }) %>

<h2 class="section-title mb-3">Patient History</h2>

<div class="card border-0 shadow-sm mb-3">
  <div class="card-body small">
    <h6 class="fw-semibold mb-1"><%= patient.name %></h6>
    <div class="text-muted"><%= patient.email %></div>
  </div>
</div>

<div class="card border-0 shadow-sm">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover app-table mb-0">
        <thead>
          <tr>
            <th>Date</th>
            <th>Time</th>
            <th>Status</th>
            <th>Type</th>
            <th>Notes</th>
            <th>Prescription</th>
          </tr>
        </thead>
        <tbody>
          <% if (!appointments.length) { %>
          <tr>
            <td colspan="6" class="text-center py-4 small text-muted">
              No appointments found for this patient with you.
            </td>
          </tr>
          <% } %>
          <% appointments.forEach(function(a) { %>
          <tr>
            <td class="small"><%= formatDate(a.appointment_date) %></td>
            <td class="small"><%= formatTime(a.appointment_time) %></td>
            <td class="small"><%= a.status %></td>
            <td class="small">
              <% if (a.parent_appointment_id) { %>
                Follow-up
              <% } else { %>
                Primary
              <% } %>
            </td>
            <td class="small text-muted" style="max-width: 220px;">
              <%= (a.doctor_notes || '').substring(0, 120) %>
              <% if ((a.doctor_notes || '').length > 120) { %>...<% } %>
            </td>
            <td class="small text-muted" style="max-width: 220px;">
              <%= (a.prescription || '').substring(0, 120) %>
              <% if ((a.prescription || '').length > 120) { %>...<% } %>
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="mt-3">
  <a href="/doctor/appointments" class="btn btn-outline-secondary rounded-pill">
    Back to Appointments
  </a>
</div>

<%- include('partials/footer') %>