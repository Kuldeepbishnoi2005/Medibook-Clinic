<%- include('partials/header', { activePage: 'doctor-appointments' }) %>

<h2 class="section-title mb-3">Appointment Notes</h2>

<div class="card border-0 shadow-sm">
  <div class="card-body p-4">
    <div class="row mb-3 small">
      <div class="col-md-4">
        <h6 class="fw-semibold">Patient</h6>
        <div><strong><%= appt.user_name %></strong></div>
        <div class="text-muted"><%= appt.user_email %></div>
        <div class="mt-1">
          <a href="/doctor/patients/<%= appt.user_id %>/history" class="small">
            View history
          </a>
        </div>
      </div>
      <div class="col-md-4">
        <h6 class="fw-semibold">Appointment</h6>
        <div>Date: <strong><%= formatDate(appt.appointment_date) %></strong></div>
        <div>Time: <strong><%= formatTime(appt.appointment_time) %></strong></div>
        <div>Status: <strong><%= appt.status %></strong></div>
        <% if (appt.parent_appointment_id) { %>
          <div class="text-muted">
            Follow-up of #<%= appt.parent_appointment_id %>
          </div>
        <% } %>
      </div>
      <div class="col-md-4">
        <h6 class="fw-semibold">Doctor</h6>
        <div><strong><%= currentDoctor ? currentDoctor.name : '' %></strong></div>
      </div>
    </div>

    <form method="POST" action="/doctor/appointments/<%= appt.id %>/notes">
      <div class="mb-3">
        <label class="form-label small">Clinical Notes</label>
        <textarea
          name="doctor_notes"
          class="form-control rounded-3"
          rows="4"
          placeholder="Symptoms, findings, diagnosis, advice, etc."
        ><%= appt.doctor_notes || '' %></textarea>
      </div>

      <div class="mb-3">
        <label class="form-label small">Prescription</label>
        <textarea
          name="prescription"
          class="form-control rounded-3"
          rows="4"
          placeholder="Medicine name, dosage, frequency, duration..."
        ><%= appt.prescription || '' %></textarea>
      </div>

      <hr class="my-3" />

      <h6 class="fw-semibold mb-2">Schedule Follow-up (optional)</h6>
      <p class="small text-muted">
        Leave these fields empty if you do not want to schedule a follow-up appointment.
      </p>

      <div class="row g-2 mb-3">
        <div class="col-md-4">
          <label class="form-label small">Follow-up Date</label>
          <input
            type="date"
            name="followup_date"
            class="form-control form-control-sm rounded-3"
            min="<%= formatDate(new Date()) %>"
          />
        </div>
        <div class="col-md-3">
          <label class="form-label small">Follow-up Time</label>
          <input
            type="time"
            name="followup_time"
            class="form-control form-control-sm rounded-3"
          />
        </div>
        <div class="col-md-5">
          <label class="form-label small">Reason (optional)</label>
          <input
            type="text"
            name="followup_reason"
            class="form-control form-control-sm rounded-3"
            placeholder="e.g. review tests, symptom check"
          />
        </div>
      </div>

      <div class="d-flex flex-wrap gap-2 mt-3">
        <button type="submit" class="btn btn-primary rounded-pill">
          Save
        </button>
        <a href="/doctor/appointments" class="btn btn-outline-secondary rounded-pill">
          Back to Appointments
        </a>
      </div>
    </form>
  </div>
</div>

<%- include('partials/footer') %>